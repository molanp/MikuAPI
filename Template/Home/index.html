<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no" />
    <meta name="renderer" content="webkit" />
    <meta name="force-rendering" content="webkit" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="keywords" content="<?= __DATA__['keywords']; ?>">
    <link rel="Shortcut Icon" href="/favicon.ico">
    <link rel="bookmark" href="/favicon.ico" type="image/x-icon" />
    <script src="/assets/js/jquery-3.7.1.min.js"></script>
    <script src="https://registry.npmmirror.com/mdui/2.0.6/files/mdui.global.js"></script>
    <script src="/assets/js/init.js"></script>
    <script src="/assets/js/marked.min.js"></script>
    <script src="/assets/js/app.js"></script>
    <title>
        <?=__DATA__["title"]?>
    </title>
</head>

<body>
    <?php include __TEMPLATE_DIR__ . DIRECTORY_SEPARATOR . "Home" . DIRECTORY_SEPARATOR . "public.html"?>
    <div class="col-3">
        <div class="left">
            <mdui-card class="archives">
                近期公告
                <mdui-list style="width: 100%;max-height:30vh;overflow:auto">
                    <?=$announce_list?>
                </mdui-list>
            </mdui-card>
        </div>
        <div class="center">
            <noscript>
                <div style="text-align: center;margin-top: 10%;">
                    <h4>Sorry, the web page requires a Javascript runtime environment, please allow you to run scripts
                        or
                        use a new version of the modern browser.</h4>
                    <p>It is recommended to use <a href="https://www.microsoft.com/edge/">Edge</a> modern browser.</p>
                </div>
            </noscript>
            <div id="app_api">
                <?php
        $count = [];
        $query = "SELECT url, COUNT(*) AS count FROM miku_access GROUP BY url";
        $stmt = $DATABASE->prepare($query);
        $stmt->execute();
        while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
            $count[$row["url"]] = $row["count"];
        }
        $query = $DATABASE->prepare("SELECT name, top, type, author, time, url_path, profile 
        FROM miku_api 
        ORDER BY top DESC, name
        LIMIT 12 OFFSET 0");
        $query->execute();
        while ($row = $query->fetch(PDO::FETCH_ASSOC)) {
            $count = $count["/api" . $row["url_path"]] ?? 0;
            $top_str = ($row["top"] == "true") ? '
            <div class="post-meta-devide">|</div>
            <div class="post-meta-detail">
                <mdui-icon name="push_pin" style="font-size: 14.5px;"></mdui-icon>置顶
            </div>
            ' : '';            
            echo '
                <mdui-card class="text-center" href="docs' . $row['url_path'] . '">
                <header class="post-header text-center">
                    <a class="post-title" href="docs' . $row['url_path'] . '">' . $row["name"] . '</a>' . '
                    <div class="post-meta">
                        <div class="post-meta-detail">
                            <mdui-icon name="account_circle" style="font-size: 14.5px;"></mdui-icon>' . $row["author"] . '
                        </div>
                        <div class="post-meta-devide">|</div>
                        <div class="post-meta-detail">
                            <mdui-icon name="access_time" style="font-size: 14.5px;"></mdui-icon>' . $row["time"] . '
                        </div>
                        <div class="post-meta-devide">|</div>
                        <div class="post-meta-detail">
                            <mdui-icon name="equalizer" style="font-size: 14.5px;"></mdui-icon>' . $count . '次
                        <div class="post-meta-devide">|</div>
                        <div class="post-meta-detail">
                            <mdui-icon name="bookmark_border" style="font-size: 14.5px;"></mdui-icon>' . $row["type"] . '
                        </div>
                        ' . $top_str . '
                    </div>
                </header>
                <div class="post-content">' . mb_substr($row["profile"], 0, 50, 'UTF-8') . '</div>
        </mdui-card>';
        }
        ?>
            </div>
            <div id="lazyload" class="grid">
                <mdui-button id='2' onclick='lazyload(this)'>继续加载</mdui-button>
            </div>
            <footer class="text-center">
                <mdui-card>
                    <span id="record">
                        <?=__DATA__['record']?>
                    </span>
                    <span id="copyright">&copy;
                        <?=__DATA__['copyright']?>
                    </span>
                </mdui-card>
            </footer>
        </div>
        <div class="right">
            <mdui-card class="overview">
                <?=$overview?>
            </mdui-card>
        </div>
    </div>
</body>

</html>